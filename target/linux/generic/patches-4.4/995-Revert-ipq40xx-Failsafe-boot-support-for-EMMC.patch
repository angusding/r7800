From 4de24fffb14c6f3f261ed07b56d05a51fa7bf01c Mon Sep 17 00:00:00 2001
From: Pavel Kubelun <be.dissent@gmail.com>
Date: Thu, 6 Jul 2017 05:13:47 -0400
Subject: [PATCH 2/3] Revert "ipq40xx: Failsafe boot support for EMMC"

This reverts commit a4c9227bc16630f3f85332450600cd21d47d51e5.
---
 block/partitions/efi.c | 13 +------------
 1 file changed, 1 insertion(+), 12 deletions(-)

diff --git a/block/partitions/efi.c b/block/partitions/efi.c
index 81db136..b2dfeb2 100644
--- a/block/partitions/efi.c
+++ b/block/partitions/efi.c
@@ -110,7 +110,6 @@
  * the partition tables happens after init too.
  */
 static int force_gpt;
-static char saved_rootfs_name[64] __initdata;
 static int __init
 force_gpt_fn(char *str)
 {
@@ -119,12 +118,6 @@ force_gpt_fn(char *str)
 }
 __setup("gpt", force_gpt_fn);
 
-static int __init rootfs_name_setup(char *line)
-{
-	strlcpy(saved_rootfs_name, line, sizeof(saved_rootfs_name));
-	return 1;
-}
-__setup("rootfsname=", rootfs_name_setup);
 
 /**
  * efi_crc32() - EFI version of crc32 function
@@ -697,9 +690,6 @@ int efi_partition(struct parsed_partitions *state)
 	u32 i;
 	unsigned ssz = bdev_logical_block_size(state->bdev) / 512;
 
-	if (!saved_rootfs_name[0])
-		strlcpy(saved_rootfs_name, "rootfs", sizeof("rootfs"));
-
 	if (!find_valid_gpt(state, &gpt, &ptes) || !gpt || !ptes) {
 		kfree(gpt);
 		kfree(ptes);
@@ -740,8 +730,7 @@ int efi_partition(struct parsed_partitions *state)
 			label_count++;
 		}
 
-		if (ROOT_DEV == 0 &&
-		    !strcmp(info->volname, saved_rootfs_name) &&
+		if (ROOT_DEV == 0 && !strcmp(info->volname, "rootfs") &&
 		    config_enabled(CONFIG_MTD_ROOTFS_ROOT_DEV)) {
 			ROOT_DEV = MKDEV(MAJOR(state->bdev->bd_dev), i + 1);
 			pr_notice("GPT: device [%d:%d] (%s) set to be root filesystem\n",
-- 
2.7.4

